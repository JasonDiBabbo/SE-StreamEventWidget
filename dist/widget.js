(()=>{"use strict";class e{static Get(e){if(Object.prototype.hasOwnProperty.call(this.fieldData,e))return this.fieldData[e]}static Set(e,t){this.fieldData[e]=t}}e.fieldData={};class t{}t.AlertFadeTime="AlertFadeTime",t.AlertDisplayTime="AlertDisplayTime",t.AlertSlideTime="AlertSlideTime",t.CheerAlertSound="CheerAlertSound",t.EventDisplayTime="EventDisplayTime",t.FollowAlertSound="FollowAlertSound",t.HostAlertSound="HostAlertSound",t.GiftedSubAlertSound="GiftedSubAlertSound",t.RaidAlertSound="RaidAlertSound",t.SubAlertSound="SubAlertSound",t.TipAlertSound="TipAlertSound";class n{static toMilliseconds(e){return 1e3*e}static toSeconds(e){return e/1e3}}class s{constructor(n){this.eventService=n,this.alertDisplayTime=e.Get(t.AlertDisplayTime),this.eventDisplayTime=e.Get(t.EventDisplayTime)}addEvents(...e){if(!e)throw new Error("Parameter 'events' cannot be null or undefined.");e.forEach((e=>this.eventService.registerEvent(e)))}beginCycle(){this.initializeCurrentSlide().then((e=>this.cycleContent(e)))}triggerAlert(e,t=!0){t&&this.addEvents(e);const n=this.getBar(),s=this.getCurrentSlide(),r=class{static createAlertSlide(e){const t=document.createElement("div");t.classList.add("slide-content"),t.innerHTML=e.html;const n=document.createElement("div");return n.classList.add("slide"),n.appendChild(t),n.classList.add(e.alertCssClass),n}}.createAlertSlide(e);this.placeSlideOffscreenBottom(r),n.appendChild(r),Promise.all([this.animateSlideUpOut(s),this.animateSlideUpIn(r)]).then((()=>n.removeChild(s))).then((()=>this.waitForAlertDisplay())).then((()=>this.markAlertAsRead(r))).then((()=>this.cycleContent(r)))}animateSlideUpIn(e){return this.requestBrowserAnimation(e),new Promise((t=>{const n=s=>{"transform"===s.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.remove("offscreen-bottom")}))}animateSlideUpOut(e){return new Promise((t=>{const n=s=>{"transform"===s.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.add("offscreen-top")}))}cycleContent(e){this.processSlideContent(e).then((()=>{e===this.getCurrentSlide()&&this.cycleContent(e)}))}getBar(){return document.querySelector(".bar")}getCurrentSlide(){const e=this.getBar();if(!e)throw new Error("Element with '.bar' class not found.");const t=e.children;if(!t||t.length<1)throw new Error("No children found in bar.");return t[0]}getSlideContent(e){return e.children[0]}hideContent(e){const t=this.getSlideContent(e);return new Promise((e=>{const n=s=>{"opacity"===s.propertyName&&(t.removeEventListener("transitionend",n),e())};t.addEventListener("transitionend",n),t.classList.add("hidden")}))}initializeCurrentSlide(){const e=this.getCurrentSlide(),t=this.eventService.getCurrentEvent();return this.populateSlide(e,t).then((()=>e))}markAlertAsRead(e){return new Promise((t=>{const n=s=>{"background-color"===s.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.value="slide"}))}placeSlideOffscreenBottom(e){e.classList.add("offscreen-bottom")}populateSlide(e,t){const n=this.getSlideContent(e);return new Promise((e=>{n.innerHTML=t.html,e()}))}processSlideContent(e){return this.waitForEventDisplay().then((()=>this.hideContent(e))).then((()=>this.populateSlide(e,this.eventService.getNextEvent()))).then((()=>this.revealContent(e)))}requestBrowserAnimation(e){e.offsetWidth}revealContent(e){const t=this.getSlideContent(e);return new Promise((e=>{const n=s=>{"opacity"===s.propertyName&&(t.removeEventListener("transitionend",n),e())};t.addEventListener("transitionend",n),t.classList.remove("hidden")}))}waitForAlertDisplay(){return new Promise((e=>{window.setTimeout((()=>e()),this.alertDisplayTime)}))}waitForEventDisplay(){return new Promise((e=>{window.setTimeout((()=>e()),this.eventDisplayTime)}))}}class r{constructor(e){this.type=e}}var i;!function(e){e[e.Cheer=0]="Cheer",e[e.Follow=1]="Follow",e[e.GiftedSubscription=2]="GiftedSubscription",e[e.Raid=3]="Raid",e[e.Subscription=4]="Subscription"}(i||(i={}));class a extends r{constructor(n,s){if(super(i.Cheer),this.name=n,this.amount=s,!n)throw new Error("Parameter 'name' cannot be null or empty.");if(s<1)throw new Error("Parameter 'amount' cannot be less than 1.");this.html=this.generateHtml(),this.alertCssClass=this.getAlertCssClass(),this.alertSound=e.Get(t.CheerAlertSound)}getAlertCssClass(){return this.amount<100?"tier-one-cheer-alert":this.amount<1e3?"tier-two-cheer-alert":this.amount<5e3?"tier-three-cheer-alert":this.amount<1e4?"tier-four-cheer-alert":"tier-five-cheer-alert"}generateHtml(){const e=`X${this.amount.toString()}`;return`<svg class="slide-icon" viewBox="0 0 187.35 242.67">\n                <path d="M221.2,159.15l-82.46-29.27a6.63,6.63,0,0,0-4.48,0L51.8,159.15a6.7,6.7,0,0,1-7.83-10l86.95-131a6.7,6.7,0,0,1,11.16,0l86.95,131A6.7,6.7,0,0,1,221.2,159.15Z" transform="translate(-42.83 -15.17)"/>\n                <path d="M220.25,195.51l-80.09,61.24a6.7,6.7,0,0,1-7.32,0L52.75,195.51a6.69,6.69,0,0,1,1.42-11.92l80.09-28.44a6.75,6.75,0,0,1,4.48,0l80.09,28.44A6.69,6.69,0,0,1,220.25,195.51Z" transform="translate(-42.83 -15.17)"/>\n            </svg><span class="slide-text">${this.name} ${e}</span>`}}class o extends r{constructor(n){if(super(i.Follow),this.name=n,!n)throw new Error("Parameter 'name' cannot be null or empty.");this.html=this.generateHtml(),this.alertCssClass="follow-alert",this.alertSound=e.Get(t.FollowAlertSound)}generateHtml(){return`<i class="slide-icon fas fa-heart"></i><span class="slide-text">${this.name}</span>`}}class l extends r{constructor(n,s){if(super(i.GiftedSubscription),this.name=n,this.amount=s,!n)throw new Error("Parameter 'name' cannot be null or empty.");s||(this.amount=1),this.html=this.generateHtml(),this.alertCssClass="gifted-sub-alert",this.alertSound=e.Get(t.GiftedSubAlertSound)}generateHtml(){const e=`X${this.amount.toString()}`;return` <i class="slide-icon fas fa-gift"></i><span class="slide-text">${this.name} ${e}</span>`}}class d extends r{constructor(n,s){if(super(i.Raid),this.name=n,this.amount=s,!n)throw new Error("Parameter 'name' cannot be null or empty.");if(s<1)throw new Error("Parameter 'amount' cannot be less than 1.");this.html=this.generateHtml(),this.alertCssClass="raid-alert",this.alertSound=e.Get(t.RaidAlertSound)}generateHtml(){const e=`X${this.amount.toString()}`;return` <i class="slide-icon fas fa-users"></i><span class="slide-text">${this.name} ${e}</span>`}}class h extends r{constructor(n,s,r){if(super(i.Subscription),this.name=n,this.amount=s,this.tier=r,!n)throw new Error("Parameter 'name' cannot be null, empty or undefined..");if(s<1)throw new Error("Parameter 'amount' cannot be less than 1.");if(!r)throw new Error("Parameter 'tier' cannot be null, empty or undefined.");this.html=this.generateHtml(),this.alertCssClass=this.getAlertCssClass(),this.alertSound=e.Get(t.SubAlertSound)}getAlertCssClass(){let e;switch(this.tier){case"1000":case"2000":case"3000":e="sub-alert";break;case"prime":e="prime-sub-alert";break;default:e="sub-alert"}return e}generateHtml(){const e=`X${this.amount.toString()}`;let t;return t="prime"===this.tier?'<svg class="slide-icon" viewBox="0 0 200.9 124.26">\n            <path d="M187.63,120.42H13.27c-5.1,0-9.22-4.14-9.2-9.24L4.4,22.26c0.01-1.85,2.22-2.81,3.58-1.55L45.17,55.4\n                c0.84,0.78,2.15,0.76,2.96-0.06L98.18,4.78c1.25-1.26,3.28-1.26,4.53,0l49.57,50.07c1.08,1.09,2.83,1.12,3.95,0.08l35.5-33.12\n                c1.81-1.69,4.76-0.41,4.77,2.06l0.33,87.3C196.85,116.28,192.73,120.42,187.63,120.42z"/>\n            </svg>':'<i class="slide-icon fas fa-star"></i>',` ${t}<span class="slide-text">${this.name} ${e}</span>`}}class c{constructor(e,t){this.audioElement=e,this.audioElement.volume=t||.35}playAudio(e){return this.audioElement.src=e,this.audioElement.play()}}class u{constructor(){this.events=[],this.eventIndex=-1}getCurrentEvent(){if(this.events.length>0&&this.eventIndex>=0)return this.events[this.eventIndex];throw new Error("There are no events.")}getNextEvent(){if(this.events.length>0&&this.eventIndex>=0)return this.advanceEventIndex(),this.events[this.eventIndex];throw new Error("There are no events.")}registerEvent(e){if(!e)throw new Error("Parameter 'event' cannot be null or undefined.");const t=this.events.findIndex((t=>t.type===e.type));-1!==t?this.events.splice(t,1,e):this.events.push(e),1===this.events.length&&(this.eventIndex=0)}advanceEventIndex(){this.eventIndex<0||this.eventIndex+1===this.events.length?this.eventIndex=0:this.eventIndex+=1}}const m=new class{constructor(){this.skippableEvents=["bot:counter","event:test","event:skip","message"]}onEventReceived(e){if(this.canSkipEvent(e))return;let t,n=!0;"follower-latest"===e.listener?t=new o(e.event.name):"cheer-latest"===e.listener?t=new a(e.event.name,e.event.amount):"subscriber-latest"===e.listener?e.event.gifted&&e.event.isCommunityGift||(t=e.event.bulkGifted?new l(e.event.sender,e.event.amount):e.event.gifted?new l(e.event.sender):new h(e.event.name,e.event.amount,e.event.tier)):"raid-latest"===e.listener&&(t=new d(e.event.name,e.event.amount),n=!1),t?(this.bar.triggerAlert(t,n),this.audioService.playAudio(t.alertSound)):SE_API.resumeQueue()}onWidgetLoad(e){const t=e.session.data,n=e.fieldData,r=document.getElementById("alert-audio");this.loadFieldData(n),this.audioService=new c(r),this.eventService=new u,this.bar=new s(this.eventService),this.loadInitialEvents(t),this.bar.beginCycle()}canSkipEvent(e){return this.skippableEvents.includes(e.listener)}loadFieldData(s){const r=s.cheerAlertSound,i=s.followAlertSound,a=s.subAlertSound,o=s.giftedSubAlertSound,l=s.raidAlertSound,d=s.hostAlertSound,h=n.toMilliseconds(s.eventDisplayTime),c=n.toMilliseconds(s.alertDisplayTime),u=n.toMilliseconds(s.alertSlideTime),m=n.toMilliseconds(s.alertFadeTime);e.Set(t.CheerAlertSound,r),e.Set(t.FollowAlertSound,i),e.Set(t.SubAlertSound,a),e.Set(t.GiftedSubAlertSound,o),e.Set(t.RaidAlertSound,l),e.Set(t.HostAlertSound,d),e.Set(t.EventDisplayTime,h),e.Set(t.AlertDisplayTime,c),e.Set(t.AlertSlideTime,u),e.Set(t.AlertFadeTime,m)}loadInitialEvents(e){const t=this.getLatestFollowEvent(e),n=this.getLatestSubEvent(e),s=this.getLatestCheerEvent(e);this.bar.addEvents(t,n,s)}getLatestCheerEvent(e){const t=e["cheer-latest"];return new a(t.name,t.amount)}getLatestFollowEvent(e){const t=e["follower-latest"];return new o(t.name)}getLatestSubEvent(e){const t=e["subscriber-latest"];let n;return n=t.gifted&&"gift"===t.amount?new h(t.name,t.count,t.tier):new h(t.name,t.amount,t.tier),n}};window.addEventListener("onEventReceived",(function(e){m.onEventReceived(e.detail)})),window.addEventListener("onWidgetLoad",(function(e){m.onWidgetLoad(e.detail)}))})();