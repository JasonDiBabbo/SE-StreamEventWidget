(()=>{"use strict";class e{}e.FeedAlertFadeTime="feedAlertFadeTime",e.FeedAlertDisplayTime="feedAlertDisplayTime",e.FeedAlertEnterTime="feedAlertEnterTime",e.FeedEventDisplayTime="feedEventDisplayTime",e.TierOneCheerAlertSound="tierOneCheerAlertSound",e.TierTwoCheerAlertSound="tierTwoCheerAlertSound",e.TierThreeCheerAlertSound="tierThreeCheerAlertSound",e.TierFourCheerAlertSound="tierFourCheerAlertSound",e.TierFiveCheerAlertSound="tierFiveCheerAlertSound",e.FollowAlertSound="followAlertSound",e.SubAlertSound="subAlertSound",e.GiftedSubAlertSound="giftedSubAlertSound",e.PrimeSubAlertSound="primeSubAlertSound",e.RaidAlertSound="raidAlertSound";const t=[{objectKey:e.FeedAlertFadeTime,type:"number"},{objectKey:e.FeedAlertDisplayTime,type:"number"},{objectKey:e.FeedAlertEnterTime,type:"number"},{objectKey:e.TierOneCheerAlertSound,type:"string"},{objectKey:e.TierTwoCheerAlertSound,type:"string"},{objectKey:e.TierThreeCheerAlertSound,type:"string"},{objectKey:e.TierFourCheerAlertSound,type:"string"},{objectKey:e.TierFiveCheerAlertSound,type:"string"},{objectKey:e.FeedEventDisplayTime,type:"number"},{objectKey:e.FollowAlertSound,type:"string"},{objectKey:e.GiftedSubAlertSound,type:"string"},{objectKey:e.RaidAlertSound,type:"string"},{objectKey:e.SubAlertSound,type:"string"},{objectKey:e.GiftedSubAlertSound,type:"string"},{objectKey:e.PrimeSubAlertSound,type:"string"}];class n{static Initialize(e){for(const r of t){if(!Object.prototype.hasOwnProperty.call(e,r.objectKey))throw new Error(`Setting '${r.objectKey}' not found in field data.`);if(null==e[r.objectKey])throw new Error(`Setting '${r.objectKey}' value is null or undefined.`);switch(r.type){case"number":n.Set(r.objectKey,e[r.objectKey]);break;case"string":default:n.Set(r.objectKey,e[r.objectKey])}}}static Get(e){if(Object.prototype.hasOwnProperty.call(this.fieldData,e))return this.fieldData[e]}static Set(e,t){this.fieldData[e]=t}}n.fieldData={};class r{static toMilliseconds(e){return 1e3*e}static toSeconds(e){return e/1e3}}class i{constructor(t){if(this.eventService=t,!this.eventService)throw new Error("Parameter 'eventService' is null or undefined.");if(!document)throw new Error("Global 'document' object is null or undefined.");this.document=document,this.slideDeck=this.document.querySelector(".slide-deck"),this.alertDisplayTime=r.toMilliseconds(n.Get(e.FeedAlertDisplayTime)),this.eventDisplayTime=r.toMilliseconds(n.Get(e.FeedEventDisplayTime))}get currentSlide(){const e=this.slideDeck.children;if(!e||e.length<1)throw new Error("Cannot get current slide. No slides in slide deck.");return e[0]}start(){this.initializeCurrentSlide().then((e=>this.processEvents(e)))}triggerAlert(e){const t=this.currentSlide,n=this.createAlertSlide(e);this.slideDeck.appendChild(n),Promise.all([this.animateSlideUpOut(t),this.animateSlideUpIn(n)]).then((()=>this.slideDeck.removeChild(t))).then((()=>this.wait(this.alertDisplayTime))).then((()=>this.clearAlert(n))).then((()=>this.processEvents(n)))}animateSlideUpIn(e){return this.requestBrowserAnimation(e),new Promise((t=>{const n=r=>{"transform"===r.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.remove("offscreen-bottom")}))}animateSlideUpOut(e){return new Promise((t=>{const n=r=>{"transform"===r.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.add("offscreen-top")}))}clearAlert(e){return new Promise((t=>{const n=r=>{"background-color"===r.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.value="slide"}))}createAlertSlide(e){const t=document.createElement("div");return t.classList.add("slide"),t.innerHTML=e.html,t.classList.add(e.alertCssClass,"offscreen-bottom"),t}fadeInSlideEvent(e){return new Promise((t=>{const n=r=>{"opacity"===r.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.remove("hidden")}))}fadeOutSlideEvent(e){return new Promise((t=>{const n=r=>{"opacity"===r.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.add("hidden")}))}initializeCurrentSlide(){const e=this.currentSlide,t=this.eventService.getCurrentEvent();return this.setSlide(e,t.html).then((()=>e))}processEvents(e){const t=this.eventService.getNextEvent();this.processSlideEvent(e,t).then((()=>{e===this.currentSlide&&this.processEvents(e)}))}processSlideEvent(e,t){return this.wait(this.eventDisplayTime).then((()=>this.fadeOutSlideEvent(e))).then((()=>this.setSlide(e,t.html))).then((()=>this.fadeInSlideEvent(e)))}requestBrowserAnimation(e){e.offsetWidth}setSlide(e,t){return new Promise((n=>{e.innerHTML=t,n()}))}wait(e){return new Promise((t=>{window.setTimeout((()=>t()),e)}))}}class s{constructor(e){this.type=e}}var o;!function(e){e[e.Cheer=0]="Cheer",e[e.Follow=1]="Follow",e[e.GiftedSubscription=2]="GiftedSubscription",e[e.Raid=3]="Raid",e[e.Subscription=4]="Subscription"}(o||(o={}));class a extends s{constructor(e,t){if(super(o.Cheer),this.name=e,this.amount=t,!e)throw new Error("Parameter 'name' cannot be null or empty.");if(t<1)throw new Error("Parameter 'amount' cannot be less than 1.");this.html=this.generateHtml(),this.alertCssClass=this.getAlertCssClass(),this.alertSound=this.getAlertSound()}getAlertCssClass(){return this.amount<100?"tier-one-cheer-alert":this.amount<1e3?"tier-two-cheer-alert":this.amount<5e3?"tier-three-cheer-alert":this.amount<1e4?"tier-four-cheer-alert":"tier-five-cheer-alert"}getAlertSound(){let t;return t=this.amount<100?e.TierOneCheerAlertSound:this.amount<1e3?e.TierTwoCheerAlertSound:this.amount<5e3?e.TierThreeCheerAlertSound:this.amount<1e4?e.TierFourCheerAlertSound:e.TierFiveCheerAlertSound,n.Get(t)}generateHtml(){const e=`X${this.amount.toString()}`;return`<svg class="slide-icon" viewBox="0 0 187.35 242.67">\n                <path d="M221.2,159.15l-82.46-29.27a6.63,6.63,0,0,0-4.48,0L51.8,159.15a6.7,6.7,0,0,1-7.83-10l86.95-131a6.7,6.7,0,0,1,11.16,0l86.95,131A6.7,6.7,0,0,1,221.2,159.15Z" transform="translate(-42.83 -15.17)"/>\n                <path d="M220.25,195.51l-80.09,61.24a6.7,6.7,0,0,1-7.32,0L52.75,195.51a6.69,6.69,0,0,1,1.42-11.92l80.09-28.44a6.75,6.75,0,0,1,4.48,0l80.09,28.44A6.69,6.69,0,0,1,220.25,195.51Z" transform="translate(-42.83 -15.17)"/>\n            </svg><span class="slide-text">${this.name} ${e}</span>`}}class l extends s{constructor(t){if(super(o.Follow),this.name=t,!t)throw new Error("Parameter 'name' cannot be null or empty.");this.html=this.generateHtml(),this.alertCssClass="follow-alert",this.alertSound=n.Get(e.FollowAlertSound)}generateHtml(){return`<i class="slide-icon fas fa-heart"></i><span class="slide-text">${this.name}</span>`}}class d extends s{constructor(t,r){if(super(o.GiftedSubscription),this.name=t,this.amount=r,!t)throw new Error("Parameter 'name' cannot be null or empty.");r||(this.amount=1),this.html=this.generateHtml(),this.alertCssClass="gifted-sub-alert",this.alertSound=n.Get(e.GiftedSubAlertSound)}generateHtml(){const e=`X${this.amount.toString()}`;return` <i class="slide-icon fas fa-gift"></i><span class="slide-text">${this.name} ${e}</span>`}}class h extends s{constructor(t,r){if(super(o.Raid),this.name=t,this.amount=r,!t)throw new Error("Parameter 'name' cannot be null or empty.");if(r<1)throw new Error("Parameter 'amount' cannot be less than 1.");this.html=this.generateHtml(),this.alertCssClass="raid-alert",this.alertSound=n.Get(e.RaidAlertSound)}generateHtml(){const e=`X${this.amount.toString()}`;return` <i class="slide-icon fas fa-users"></i><span class="slide-text">${this.name} ${e}</span>`}}class u extends s{constructor(e,t,n){if(super(o.Subscription),this.name=e,this.amount=t,this.tier=n,!e)throw new Error("Parameter 'name' cannot be null, empty or undefined..");if(t<1)throw new Error("Parameter 'amount' cannot be less than 1.");if(!n)throw new Error("Parameter 'tier' cannot be null, empty or undefined.");this.html=this.generateHtml(),this.alertCssClass=this.getAlertCssClass(),this.alertSound=this.getAlertSound()}getAlertCssClass(){let e;switch(this.tier){case"1000":case"2000":case"3000":e="sub-alert";break;case"prime":e="prime-sub-alert";break;default:e="sub-alert"}return e}getAlertSound(){let t;switch(this.tier){case"prime":t=e.PrimeSubAlertSound;break;case"1000":case"2000":case"3000":default:t=e.SubAlertSound}return n.Get(t)}generateHtml(){const e=`X${this.amount.toString()}`;let t;return t="prime"===this.tier?'<svg class="slide-icon" viewBox="0 0 200.9 124.26">\n            <path d="M187.63,120.42H13.27c-5.1,0-9.22-4.14-9.2-9.24L4.4,22.26c0.01-1.85,2.22-2.81,3.58-1.55L45.17,55.4\n                c0.84,0.78,2.15,0.76,2.96-0.06L98.18,4.78c1.25-1.26,3.28-1.26,4.53,0l49.57,50.07c1.08,1.09,2.83,1.12,3.95,0.08l35.5-33.12\n                c1.81-1.69,4.76-0.41,4.77,2.06l0.33,87.3C196.85,116.28,192.73,120.42,187.63,120.42z"/>\n            </svg>':'<i class="slide-icon fas fa-star"></i>',` ${t}<span class="slide-text">${this.name} ${e}</span>`}}class c{constructor(e,t){this.audioElement=e,this.audioElement.volume=t||.35}playAudio(e){return this.audioElement.src=e,this.audioElement.play()}}class m{constructor(){this.events=[],this.eventIndex=-1}getCurrentEvent(){if(this.events.length>0&&this.eventIndex>=0)return this.events[this.eventIndex];throw new Error("There are no events.")}getNextEvent(){if(this.events.length>0&&this.eventIndex>=0)return this.advanceEventIndex(),this.events[this.eventIndex];throw new Error("There are no events.")}registerEvent(e){if(!e)throw new Error("Parameter 'event' cannot be null or undefined.");const t=this.events.findIndex((t=>t.type===e.type));-1!==t&&this.events.splice(t,1),this.events.push(e),this.eventIndex=this.events.length-1}advanceEventIndex(){this.eventIndex<0||this.eventIndex+1===this.events.length?this.eventIndex=0:this.eventIndex+=1}}new class{constructor(){if(this.skippableEvents=["bot:counter","event:test","event:skip","message"],!globalThis.window)throw new Error("Global 'window' object was null or undefined.");if(!document)throw new Error("Global 'document' object was null or undefined.");this.window=globalThis.window,this.document=document,this.setupEventListeners()}canSkipEvent(e){return this.skippableEvents.includes(e.listener)}getLatestCheerEvent(e){try{const t=e["cheer-latest"];return new a(t.name,t.amount)}catch{return null}}getLatestFollowEvent(e){try{const t=e["follower-latest"];return new l(t.name)}catch{return null}}getLatestSubEvent(e){try{const t=e["subscriber-latest"];return t.gifted&&"gift"===t.amount?new u(t.name,t.count,t.tier):new u(t.name,t.amount,t.tier)}catch{return null}}handleNewCheerEvent(e){return new a(e.name,e.amount)}handleNewFollowerEvent(e){return new l(e.name)}handleRaidEvent(e){return new h(e.name,e.amount)}handleNewSubscriberEvent(e){return e.gifted&&e.isCommunityGift?null:e.bulkGifted?new d(e.sender,e.amount):e.gifted?new d(e.sender):new u(e.name,e.amount,e.tier)}initializeAudio(){const e=this.document.getElementById("alert-audio");this.audioService=new c(e)}initializeEvents(e){this.eventService=new m;const t=this.getLatestFollowEvent(e),n=this.getLatestSubEvent(e),r=this.getLatestCheerEvent(e);t&&this.eventService.registerEvent(t),n&&this.eventService.registerEvent(n),r&&this.eventService.registerEvent(r)}onEventReceived(e){const t=e.detail;if(this.canSkipEvent(t))return;let n,r=!0;switch(t.listener){case"follower-latest":n=this.handleNewFollowerEvent(t.event);break;case"cheer-latest":n=this.handleNewCheerEvent(t.event);break;case"subscriber-latest":n=this.handleNewSubscriberEvent(t.event);break;case"raid-latest":n=this.handleRaidEvent(t.event),r=!1}n?(r&&this.eventService.registerEvent(n),this.eventFeed.triggerAlert(n),this.audioService.playAudio(n.alertSound)):SE_API.resumeQueue()}onWidgetLoad(e){const t=e.detail,r=t.session.data,s=t.fieldData;n.Initialize(s),this.initializeAudio(),this.initializeEvents(r),this.eventFeed=new i(this.eventService),this.eventFeed.start()}setupEventListeners(){this.window.addEventListener("onEventReceived",(e=>this.onEventReceived(e))),this.window.addEventListener("onWidgetLoad",(e=>this.onWidgetLoad(e)))}}})();