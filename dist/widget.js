(()=>{"use strict";class e{static Get(e){if(Object.prototype.hasOwnProperty.call(this.fieldData,e))return this.fieldData[e]}static Set(e,t){this.fieldData[e]=t}}e.fieldData={};class t{}t.EventDisplayTime="EventDisplayTime",t.AlertSlideTime="AlertSlideTime",t.AlertFadeTime="AlertFadeTime",t.AlertDisplayTime="AlertDisplayTime";class n{static toMilliseconds(e){return 1e3*e}static toSeconds(e){return e/1e3}}class r{constructor(n,r){this.eventService=n,this.alertService=r,this.alertDisplayTime=e.Get(t.AlertDisplayTime),this.eventDisplayTime=e.Get(t.EventDisplayTime)}addEvents(...e){if(!e)throw new Error("Parameter 'events' cannot be null or undefined.");e.forEach((e=>this.eventService.registerEvent(e)))}beginCycle(){this.initializeCurrentSlide().then((e=>this.cycleContent(e)))}triggerAlert(e,t=!0){t&&this.addEvents(e);const n=this.getBar(),r=this.getCurrentSlide(),s=this.alertService.createAlertSlide(e);this.placeSlideOffscreenBottom(s),n.appendChild(s),Promise.all([this.animateSlideUpOut(r),this.animateSlideUpIn(s)]).then((()=>n.removeChild(r))).then((()=>this.waitForAlertDisplay())).then((()=>this.markAlertAsRead(s))).then((()=>this.cycleContent(s)))}animateSlideUpIn(e){return this.requestBrowserAnimation(e),new Promise((t=>{const n=r=>{"transform"===r.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.remove("offscreen-bottom")}))}animateSlideUpOut(e){return new Promise((t=>{const n=r=>{"transform"===r.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.add("offscreen-top")}))}cycleContent(e){this.processSlideContent(e).then((()=>{e===this.getCurrentSlide()&&this.cycleContent(e)}))}getBar(){return document.querySelector(".bar")}getCurrentSlide(){const e=this.getBar();if(!e)throw new Error("Element with '.bar' class not found.");const t=e.children;if(!t||t.length<1)throw new Error("No children found in bar.");return t[0]}getSlideContent(e){return e.children[0]}hideContent(e){const t=this.getSlideContent(e);return new Promise((e=>{const n=r=>{"opacity"===r.propertyName&&(t.removeEventListener("transitionend",n),e())};t.addEventListener("transitionend",n),t.classList.add("hidden")}))}initializeCurrentSlide(){const e=this.getCurrentSlide(),t=this.eventService.getCurrentEvent();return this.populateSlide(e,t).then((()=>e))}markAlertAsRead(e){return new Promise((t=>{const n=r=>{"background-color"===r.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.value="slide"}))}placeSlideOffscreenBottom(e){e.classList.add("offscreen-bottom")}populateSlide(e,t){const n=this.getSlideContent(e);return new Promise((e=>{n.innerHTML=t.html,e()}))}processSlideContent(e){return this.waitForEventDisplay().then((()=>this.hideContent(e))).then((()=>this.populateSlide(e,this.eventService.getNextEvent()))).then((()=>this.revealContent(e)))}requestBrowserAnimation(e){e.offsetWidth}revealContent(e){const t=this.getSlideContent(e);return new Promise((e=>{const n=r=>{"opacity"===r.propertyName&&(t.removeEventListener("transitionend",n),e())};t.addEventListener("transitionend",n),t.classList.remove("hidden")}))}waitForAlertDisplay(){return new Promise((e=>{window.setTimeout((()=>e()),this.alertDisplayTime)}))}waitForEventDisplay(){return new Promise((e=>{window.setTimeout((()=>e()),this.eventDisplayTime)}))}}class s{constructor(e){this.type=e}}var i;!function(e){e[e.Cheer=0]="Cheer",e[e.Follow=1]="Follow",e[e.GiftedSubscription=2]="GiftedSubscription",e[e.Host=3]="Host",e[e.Raid=4]="Raid",e[e.Subscription=5]="Subscription"}(i||(i={}));class a extends s{constructor(e,t){if(super(i.Cheer),this.name=e,this.amount=t,!e)throw new Error("Parameter 'name' cannot be null or empty.");if(t<1)throw new Error("Parameter 'amount' cannot be less than 1.");this.html=this.generateHtml()}generateHtml(){const e=`X${this.amount.toString()}`;return`<svg class="slide-icon" viewBox="0 0 187.35 242.67">\n                <path d="M221.2,159.15l-82.46-29.27a6.63,6.63,0,0,0-4.48,0L51.8,159.15a6.7,6.7,0,0,1-7.83-10l86.95-131a6.7,6.7,0,0,1,11.16,0l86.95,131A6.7,6.7,0,0,1,221.2,159.15Z" transform="translate(-42.83 -15.17)"/>\n                <path d="M220.25,195.51l-80.09,61.24a6.7,6.7,0,0,1-7.32,0L52.75,195.51a6.69,6.69,0,0,1,1.42-11.92l80.09-28.44a6.75,6.75,0,0,1,4.48,0l80.09,28.44A6.69,6.69,0,0,1,220.25,195.51Z" transform="translate(-42.83 -15.17)"/>\n            </svg><span class="slide-text">${this.name} ${e}</span>`}}class o extends s{constructor(e){if(super(i.Follow),this.name=e,!e)throw new Error("Parameter 'name' cannot be null or empty.");this.html=this.generateHtml()}generateHtml(){return`<i class="slide-icon fas fa-heart"></i><span class="slide-text">${this.name}</span>`}}class l extends s{constructor(e,t){if(super(i.GiftedSubscription),this.name=e,this.amount=t,!e)throw new Error("Parameter 'name' cannot be null or empty.");this.amount=t??1,this.html=this.generateHtml()}generateHtml(){const e=`X${this.amount.toString()}`;return` <i class="slide-icon fas fa-gift"></i><span class="slide-text">${this.name} ${e}</span>`}}class c extends s{constructor(e,t){if(super(i.Host),this.name=e,this.amount=t,!e)throw new Error("Parameter 'name' cannot be null or empty.");if(t<1)throw new Error("Parameter 'amount' cannot be less than 1.");this.html=this.generateHtml()}generateHtml(){const e=`X${this.amount.toString()}`;return` <i class="slide-icon fas fa-desktop"></i><span class="slide-text">${this.name} ${e}</span>`}}class d extends s{constructor(e,t){if(super(i.Raid),this.name=e,this.amount=t,!e)throw new Error("Parameter 'name' cannot be null or empty.");if(t<1)throw new Error("Parameter 'amount' cannot be less than 1.");this.html=this.generateHtml()}get isValid(){return!!this.html&&!!this.name&&!!this.amount&&this.amount>0}generateHtml(){const e=`X${this.amount.toString()}`;return` <i class="slide-icon fas fa-users"></i><span class="slide-text">${this.name} ${e}</span>`}getRaidAmountString(){if(!(this.amount&&this.amount>0))return""}}class h extends s{constructor(e,t){if(super(i.Subscription),this.name=e,this.amount=t,!e)throw new Error("Parameter 'name' cannot be null or empty.");if(t<1)throw new Error("Parameter 'amount' cannot be less than 1.");this.html=this.generateHtml()}generateHtml(){const e=`X${this.amount.toString()}`;return` <i class="slide-icon fas fa-star"></i><span class="slide-text">${this.name} ${e}</span>`}}class m{createAlertSlide(e){const t=document.createElement("div");t.classList.add("slide-content"),t.innerHTML=e.html;const n=document.createElement("div");n.classList.add("slide"),n.appendChild(t);const r=this.lookupAlertCssClass(e);return n.classList.add(r),n}lookupAlertCssClass(e){if(!e)throw new Error("Parameter 'event' cannot be null or undefined.");let t;switch(e.type){case i.Cheer:t=this.lookupCheerAlertCssClass(e.amount);break;case i.Follow:t="follow-alert";break;case i.GiftedSubscription:t="gifted-sub-alert";break;case i.Host:t="host-alert";break;case i.Raid:t="raid-alert";break;case i.Subscription:t="sub-alert"}return t}lookupCheerAlertCssClass(e){if(e<=0)throw new Error("Parameter 'amount' cannot be less than or equal to 0.");return e<100?"cheer-alert-tier-1":e<1e3?"cheer-alert-tier-2":e<5e3?"cheer-alert-tier-3":e<1e4?"cheer-alert-tier-4":"cheer-alert-tier-5"}}class u{constructor(){this.events=[],this.eventIndex=-1}getCurrentEvent(){if(this.events.length>0&&this.eventIndex>=0)return this.events[this.eventIndex];throw new Error("There are no events.")}getNextEvent(){if(this.events.length>0&&this.eventIndex>=0)return this.advanceEventIndex(),this.events[this.eventIndex];throw new Error("There are no events.")}registerEvent(e){if(!e)throw new Error("Parameter 'event' cannot be null or undefined.");const t=this.events.findIndex((t=>t.type===e.type));-1!==t&&this.events.splice(t,1),this.events.push(e),1===this.events.length&&(this.eventIndex=0)}advanceEventIndex(){this.eventIndex<0||this.eventIndex+1===this.events.length?this.eventIndex=0:this.eventIndex+=1}}const p=["bot:counter","event:test","event:skip","message"];let v,w,f;window.addEventListener("onEventReceived",(function(e){if((e=>{try{const t=e.detail.listener;return p.includes(t)}catch{return!1}})(e))return;const t=e.detail.listener,n=e.detail.event;-1===p.indexOf(t)&&("follower-latest"===t?f.triggerAlert(new o(n.name)):"cheer-latest"===t?f.triggerAlert(new a(n.name,n.amount)):"subscriber-latest"===t?n.gifted&&n.isCommunityGift?SE_API.resumeQueue():n.bulkGifted?f.triggerAlert(new l(n.sender,n.amount)):n.gifted?f.triggerAlert(new l(n.sender)):f.triggerAlert(new h(n.name,n.amount)):"host-latest"===t?f.triggerAlert(new c(n.name,n.amount),!1):"raid-latest"===t?f.triggerAlert(new d(n.name,n.amount),!1):SE_API.resumeQueue())})),window.addEventListener("onWidgetLoad",(function(e){const t=e.detail.session.data,n=e.detail.fieldData;g(n);const s=[S(t),E(t),y(t)];v=new u,w=new m,f=new r(v,w),f.addEvents(...s),f.beginCycle()}));const g=function(r){const s=n.toMilliseconds(r.eventDisplayTime),i=n.toMilliseconds(r.alertDisplayTime),a=n.toMilliseconds(r.alertSlideTime),o=n.toMilliseconds(r.alertFadeTime);e.Set(t.EventDisplayTime,s),e.Set(t.AlertDisplayTime,i),e.Set(t.AlertSlideTime,a),e.Set(t.AlertFadeTime,o)},S=function(e){const t=e["follower-latest"];return new o(t.name)},E=function(e){const t=e["subscriber-latest"];let n;return n=t.gifted&&"string"==typeof t.amount?new h(t.name,t.count):new h(t.name,t.amount),n},y=function(e){const t=e["cheer-latest"];return new a(t.name,t.amount)}})();