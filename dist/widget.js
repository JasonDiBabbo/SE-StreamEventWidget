(()=>{"use strict";class e{constructor(e){this.type=e}}var t;!function(e){e[e.Cheer=0]="Cheer",e[e.Follow=1]="Follow",e[e.GiftedSubscription=2]="GiftedSubscription",e[e.Host=3]="Host",e[e.Raid=4]="Raid",e[e.Subscription=5]="Subscription"}(t||(t={}));class n extends e{constructor(e,n){if(super(t.Cheer),this.name=e,this.amount=n,!e)throw new Error("Parameter 'name' cannot be null or empty.");if(n<1)throw new Error("Parameter 'amount' cannot be less than 1.");this.html=this.generateHtml()}generateHtml(){const e=`X${this.amount.toString()}`;return`<svg class="slide-icon" viewBox="0 0 187.35 242.67">\n                <path d="M221.2,159.15l-82.46-29.27a6.63,6.63,0,0,0-4.48,0L51.8,159.15a6.7,6.7,0,0,1-7.83-10l86.95-131a6.7,6.7,0,0,1,11.16,0l86.95,131A6.7,6.7,0,0,1,221.2,159.15Z" transform="translate(-42.83 -15.17)"/>\n                <path d="M220.25,195.51l-80.09,61.24a6.7,6.7,0,0,1-7.32,0L52.75,195.51a6.69,6.69,0,0,1,1.42-11.92l80.09-28.44a6.75,6.75,0,0,1,4.48,0l80.09,28.44A6.69,6.69,0,0,1,220.25,195.51Z" transform="translate(-42.83 -15.17)"/>\n            </svg><span class="slide-text">${this.name} ${e}</span>`}}class s extends e{constructor(e){if(super(t.Follow),this.name=e,!e)throw new Error("Parameter 'name' cannot be null or empty.");this.html=this.generateHtml()}generateHtml(){return`<i class="slide-icon fas fa-heart"></i><span class="slide-text">${this.name}</span>`}}class r extends e{constructor(e,n){if(super(t.GiftedSubscription),this.name=e,this.amount=n,!e)throw new Error("Parameter 'name' cannot be null or empty.");this.amount=n??1,this.html=this.generateHtml()}generateHtml(){const e=`X${this.amount.toString()}`;return` <i class="slide-icon fas fa-gift"></i><span class="slide-text">${this.name} ${e}</span>`}}class i extends e{constructor(e,n){if(super(t.Host),this.name=e,this.amount=n,!e)throw new Error("Parameter 'name' cannot be null or empty.");if(n<1)throw new Error("Parameter 'amount' cannot be less than 1.");this.html=this.generateHtml()}generateHtml(){const e=`X${this.amount.toString()}`;return` <i class="slide-icon fas fa-desktop"></i><span class="slide-text">${this.name} ${e}</span>`}}class a extends e{constructor(e,n){if(super(t.Raid),this.name=e,this.amount=n,!e)throw new Error("Parameter 'name' cannot be null or empty.");if(n<1)throw new Error("Parameter 'amount' cannot be less than 1.");this.html=this.generateHtml()}get isValid(){return!!this.html&&!!this.name&&!!this.amount&&this.amount>0}generateHtml(){const e=`X${this.amount.toString()}`;return` <i class="slide-icon fas fa-users"></i><span class="slide-text">${this.name} ${e}</span>`}getRaidAmountString(){if(!(this.amount&&this.amount>0))return""}}class o extends e{constructor(e,n){if(super(t.Subscription),this.name=e,this.amount=n,!e)throw new Error("Parameter 'name' cannot be null or empty.");if(n<1)throw new Error("Parameter 'amount' cannot be less than 1.");this.html=this.generateHtml()}generateHtml(){const e=`X${this.amount.toString()}`;return` <i class="slide-icon fas fa-star"></i><span class="slide-text">${this.name} ${e}</span>`}}class l{static Get(e){if(Object.prototype.hasOwnProperty.call(this.fieldData,e))return this.fieldData[e]}static Set(e,t){this.fieldData[e]=t}}l.fieldData={};class d{}d.CheerAlertSound="CheerAlertSound",d.EventDisplayTime="EventDisplayTime",d.AlertSlideTime="AlertSlideTime",d.AlertFadeTime="AlertFadeTime",d.AlertDisplayTime="AlertDisplayTime";class h{static toMilliseconds(e){return 1e3*e}static toSeconds(e){return e/1e3}}class c{constructor(e){this.eventService=e,this.alertDisplayTime=l.Get(d.AlertDisplayTime),this.eventDisplayTime=l.Get(d.EventDisplayTime)}addEvents(...e){if(!e)throw new Error("Parameter 'events' cannot be null or undefined.");e.forEach((e=>this.eventService.registerEvent(e)))}beginCycle(){this.initializeCurrentSlide().then((e=>this.cycleContent(e)))}triggerAlert(e,n=!0){n&&this.addEvents(e);const s=this.getBar(),r=this.getCurrentSlide(),i=class{static createAlertSlide(e){const t=document.createElement("div");t.classList.add("slide-content"),t.innerHTML=e.html;const n=document.createElement("div");n.classList.add("slide"),n.appendChild(t);const s=this.lookupAlertCssClass(e);return n.classList.add(s),n}static lookupAlertCssClass(e){if(!e)throw new Error("Parameter 'event' cannot be null or undefined.");let n;switch(e.type){case t.Cheer:n=this.lookupCheerAlertCssClass(e.amount);break;case t.Follow:n="follow-alert";break;case t.GiftedSubscription:n="gifted-sub-alert";break;case t.Host:n="host-alert";break;case t.Raid:n="raid-alert";break;case t.Subscription:n="sub-alert"}return n}static lookupCheerAlertCssClass(e){if(e<=0)throw new Error("Parameter 'amount' cannot be less than or equal to 0.");return e<100?"cheer-alert-tier-1":e<1e3?"cheer-alert-tier-2":e<5e3?"cheer-alert-tier-3":e<1e4?"cheer-alert-tier-4":"cheer-alert-tier-5"}}.createAlertSlide(e);this.placeSlideOffscreenBottom(i),s.appendChild(i),Promise.all([this.animateSlideUpOut(r),this.animateSlideUpIn(i)]).then((()=>s.removeChild(r))).then((()=>this.waitForAlertDisplay())).then((()=>this.markAlertAsRead(i))).then((()=>this.cycleContent(i)))}animateSlideUpIn(e){return this.requestBrowserAnimation(e),new Promise((t=>{const n=s=>{"transform"===s.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.remove("offscreen-bottom")}))}animateSlideUpOut(e){return new Promise((t=>{const n=s=>{"transform"===s.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.add("offscreen-top")}))}cycleContent(e){this.processSlideContent(e).then((()=>{e===this.getCurrentSlide()&&this.cycleContent(e)}))}getBar(){return document.querySelector(".bar")}getCurrentSlide(){const e=this.getBar();if(!e)throw new Error("Element with '.bar' class not found.");const t=e.children;if(!t||t.length<1)throw new Error("No children found in bar.");return t[0]}getSlideContent(e){return e.children[0]}hideContent(e){const t=this.getSlideContent(e);return new Promise((e=>{const n=s=>{"opacity"===s.propertyName&&(t.removeEventListener("transitionend",n),e())};t.addEventListener("transitionend",n),t.classList.add("hidden")}))}initializeCurrentSlide(){const e=this.getCurrentSlide(),t=this.eventService.getCurrentEvent();return this.populateSlide(e,t).then((()=>e))}markAlertAsRead(e){return new Promise((t=>{const n=s=>{"background-color"===s.propertyName&&(e.removeEventListener("transitionend",n),t())};e.addEventListener("transitionend",n),e.classList.value="slide"}))}placeSlideOffscreenBottom(e){e.classList.add("offscreen-bottom")}populateSlide(e,t){const n=this.getSlideContent(e);return new Promise((e=>{n.innerHTML=t.html,e()}))}processSlideContent(e){return this.waitForEventDisplay().then((()=>this.hideContent(e))).then((()=>this.populateSlide(e,this.eventService.getNextEvent()))).then((()=>this.revealContent(e)))}requestBrowserAnimation(e){e.offsetWidth}revealContent(e){const t=this.getSlideContent(e);return new Promise((e=>{const n=s=>{"opacity"===s.propertyName&&(t.removeEventListener("transitionend",n),e())};t.addEventListener("transitionend",n),t.classList.remove("hidden")}))}waitForAlertDisplay(){return new Promise((e=>{window.setTimeout((()=>e()),this.alertDisplayTime)}))}waitForEventDisplay(){return new Promise((e=>{window.setTimeout((()=>e()),this.eventDisplayTime)}))}}class m{constructor(){this.alertAudio=document.getElementById("alert-audio"),this.alertAudio.volume=.35}playAudio(e){return this.alertAudio.src=e,this.alertAudio.play()}}class u{constructor(){this.events=[],this.eventIndex=-1}getCurrentEvent(){if(this.events.length>0&&this.eventIndex>=0)return this.events[this.eventIndex];throw new Error("There are no events.")}getNextEvent(){if(this.events.length>0&&this.eventIndex>=0)return this.advanceEventIndex(),this.events[this.eventIndex];throw new Error("There are no events.")}registerEvent(e){if(!e)throw new Error("Parameter 'event' cannot be null or undefined.");const t=this.events.findIndex((t=>t.type===e.type));-1!==t?this.events.splice(t,1,e):this.events.push(e),1===this.events.length&&(this.eventIndex=0)}advanceEventIndex(){this.eventIndex<0||this.eventIndex+1===this.events.length?this.eventIndex=0:this.eventIndex+=1}}const v=new class{constructor(){this.skippableEvents=["bot:counter","event:test","event:skip","message"]}onEventReceived(e){if(this.canSkipEvent(e))return;let t,h=!0;"follower-latest"===e.listener?t=new s(e.event.name):"cheer-latest"===e.listener?(t=new n(e.event.name,e.event.amount),this.audioService.playAudio(l.Get(d.CheerAlertSound))):"subscriber-latest"===e.listener?e.event.gifted&&e.event.isCommunityGift||(t=e.event.bulkGifted?new r(e.event.sender,e.event.amount):e.event.gifted?new r(e.event.sender):new o(e.event.name,e.event.amount)):"host-latest"===e.listener?(t=new i(e.event.name,e.event.amount),h=!1):"raid-latest"===e.listener&&(t=new a(e.event.name,e.event.amount),h=!1),t?this.bar.triggerAlert(t,h):SE_API.resumeQueue()}onWidgetLoad(e){const t=e.session.data,n=e.fieldData;this.loadFieldData(n),this.audioService=new m,this.eventService=new u,this.bar=new c(this.eventService),this.loadInitialEvents(t),this.bar.beginCycle()}canSkipEvent(e){return this.skippableEvents.includes(e.listener)}loadFieldData(e){const t=e.cheerAlertSound,n=h.toMilliseconds(e.eventDisplayTime),s=h.toMilliseconds(e.alertDisplayTime),r=h.toMilliseconds(e.alertSlideTime),i=h.toMilliseconds(e.alertFadeTime);l.Set(d.CheerAlertSound,t),l.Set(d.EventDisplayTime,n),l.Set(d.AlertDisplayTime,s),l.Set(d.AlertSlideTime,r),l.Set(d.AlertFadeTime,i)}loadInitialEvents(e){const t=this.getLatestFollowEvent(e),n=this.getLatestSubEvent(e),s=this.getLatestCheerEvent(e);this.bar.addEvents(t,n,s)}getLatestCheerEvent(e){const t=e["cheer-latest"];return new n(t.name,t.amount)}getLatestFollowEvent(e){const t=e["follower-latest"];return new s(t.name)}getLatestSubEvent(e){const t=e["subscriber-latest"];let n;return n=t.gifted&&"gift"===t.amount?new o(t.name,t.count):new o(t.name,t.amount),n}};window.addEventListener("onEventReceived",(function(e){v.onEventReceived(e.detail)})),window.addEventListener("onWidgetLoad",(function(e){v.onWidgetLoad(e.detail)}))})();